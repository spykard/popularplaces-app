{% extends "layouts/base.html" %}

{% block title %} History {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}

<style>
  .list-group-item-action {
    line-height: 1.0;
  }

  .list-group-item-action:hover {
    color: #e14eca;
  }

  .list-group-item-action-primary.active {
    background-image: linear-gradient(to bottom left, #e14eca, #ba54f5, #e14eca);
  }

  .list-group-item-action-info.active {
    background-image: linear-gradient(to bottom left, #1d8cf8, #3358f4, #1d8cf8);
  }

  .list-group-item-action-success.active {
    background-image: linear-gradient(to bottom left, #00f2c3, #0098f0, #00f2c3);
  }

  .places-table-scroll {
    max-height: 507px;  
  } 
  
  .flex-fix-margin {
    margin: 18px 3px 18px 3px;
  }

  .card .card-body {
    padding-bottom: 0px;
  }

  .card .card-footer {
    padding-top: 0px;
  }  

  .carousel-caption {
    bottom: -10px;
  } 

  .live-text {
    white-space: nowrap; 
    font-size: 0.6rem; 
    font-weight: 600;  
  }  

  .live-text-calculator {
    white-space: nowrap;  
    font-weight: 600;  
  }  

  .modal-text-below {
    padding: 12px 0px 0px 0px;
    line-height: 1.0;
    text-align: center
  }  

  .box {
    width: 12rem;
    {# max-width: 18rem;
    padding-right: 15px;
    padding-left: 15px;#}
    border-radius: 5px;
    -webkit-transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
    transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
  }
  
  .box::after {
    content: "";
    border-radius: 5px;
    position: absolute;
    z-index: -1;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    {#box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);#}
    opacity: 0;
    -webkit-transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
    transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
  }
  
  .box:hover {
    -webkit-backface-visibility: hidden;
    -webkit-transform: translateZ(0) scale(1.12, 1.12);
    backface-visibility: hidden;
    transform: translateZ(0) scale(1.12, 1.12);
  }
  
  .box:hover::after {
      opacity: 1;
  }  

  @media (max-width: 320px) {
    .box {
      min-width: 84%;
    }
  }

  @media (min-width: 320px) {
    .box {
      min-width: 58%;
    }
  }  

  @media (min-width: 576px) {
    .box {
      min-width: 38%;
    }
  }
  
  @media (min-width: 768px) {
    .box {
      min-width: 28%;
    }
  }
  
  @media (min-width: 992px) {
    .box {
      min-width: 23%;
    }
  }
  
  @media (min-width: 1200px) {
    .box {
      min-width: 20%;
    }
  }

  {# /* all values found manually */
  /*@media (max-height: 480px) {
    .modal-fix-position {
      top: -33.7vh;
    }
  }

  @media (min-height: 480px) {
    .modal-fix-position {
      top: -26.4vh;
    }
  }  

  @media (min-height: 600px) {
    .modal-fix-position {
      top: -20.3vh;
    }
  }

  @media (min-height: 760px) {
    .modal-fix-position {
      top: -15.0vh;
    }
  }

  @media (min-height: 1000px) {
    .modal-fix-position {
      top: -13.9vh;
    }
  }*/ #}
</style>

{% endblock stylesheets %}

{% block content %}
    <div class="card card-profile">
      <div class="card-body">

        <h6 class="card-category text-gray">View your Past Search History</h6>
        <h3 class="card-title">
            Search History 
        </h3>

        {% if msg %}
          <h6 class="card-category">
              {% if success %}
              <span class="text-success">{{ msg | safe }}</span>
              {% else %} 
              <span class="text-danger">{{ msg | safe }}</span>
              {% endif %}
              <br>        
          </h6>  
        {% endif %}             
      </div>
    </div>

    <div class="row">
      <div id="searchHistoryList" class="col overflow-auto" style="max-height: 236px;">
        <div id="helptooltip1" class="list-group" id="list-tab" role="tablist">
          <a class="list-group-item d-flex justify-content-between align-items-center list-group-item-action list-group-item-action-{{ current_user.ui_button }} {% if current_user.ui_theme == 'dark' %}list-group-item-darkerer{% endif %} active" id="list-example-list" data-toggle="list" href="#list-example" role="tab" aria-controls="example">
            Sample Search
            <button name="deletebutton" type="button" rel="tooltip" class="btn btn-danger btn-link btn-icon btn-sm" value="0" style="height: 0.35rem; width: 0.35rem;">
                <i class="tim-icons icon-simple-remove" style="font-size: 0.9em;"></i>
            </button>
          </a>

          {% for search in searches %}
            <a class="list-group-item d-flex justify-content-between align-items-center list-group-item-action list-group-item-action-{{ current_user.ui_button }} {% if current_user.ui_theme == 'dark' %}list-group-item-darkerer{% endif %}" id="list-{{ search['name'] }}-list" data-toggle="list" href="#list-{{ search['name'] }}" role="tab" aria-controls="{{ search['name'] }}">
              {{ search['name'] }}
              <button name="deletebutton" type="button" rel="tooltip" class="btn btn-danger btn-link btn-icon btn-sm" value="{{ search['id'] }}" style="height: 0.35rem; width: 0.35rem;">
                  <i class="tim-icons icon-simple-remove" style="font-size: 0.9em;"></i>
              </button>            
            </a>          
          {% endfor %}

        </div>
      </div>
    </div>
    
    <br>

    <div class="row">        
        <div class="col">
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="list-example" role="tabpanel" aria-labelledby="list-example-list">
              <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th class="text-center">Name</th>
                            <th>City</th>    
                            <th>Type 1</th>                                                         
                            <th>Type 2</th>
                            <th>Day</th>                            
                            <th class="text-center">Time</th>                             
                        </tr>                            
                    </thead>
                    <tbody>
                          <tr>
                              <td style="display:none;">0</td>
                              <td class="text-center">Sample Search</td>                          
                              <td>New York</td>
                              <td>Cafe</td> 
                              <td>Restaurant</td> 
                              <td name="day"><p class="text-primary">Monday - 19 Hour</p></td>                                                                                                    
                              <td class="text-center">2021-01-18 19:42:03</td>
                          </tr>
                    </tbody>                                                       
                </table>
              </div>             
            </div>
          
            {% for search in searches %}
              <div class="tab-pane fade" id="list-{{ search['name'] }}" role="tabpanel" aria-labelledby="list-{{ search['name'] }}-list">
                <div class="table-responsive">              
                  <table class="table">
                      <thead>
                          <tr>
                              <th class="text-center">Name</th>
                              <th>City</th>    
                              <th>Type 1</th>                                                         
                              <th>Type 2</th>
                              <th>Day</th>                              
                              <th class="text-center">Time</th>                             
                          </tr>                            
                      </thead>
                      <tbody>
                            <tr>
                                <td style="display:none;">{{ search['id'] }}</td>                          
                                <td class="text-center">{{ search['name'] }}</td>                          
                                <td>{{ search['city'] }}</td>
                                <td>{{ search['settings_type1'] }}</td> 
                                <td>{{ search['settings_type2'] }}</td>     
                                <td name="day"><p class="text-primary">{{ search['day'] }}</p></td>
                                <td class="text-center">{{ search['time'] }}</td>
                            </tr>
                      </tbody>                                                       
                    </table>
                </div>              
              </div>
            {% endfor %}
          </div>
        </div>
    </div>

    <div class="row">        
      <div class="col">
        <div class="col-sm-12">
          <div id="helptooltip2" class="btn-group btn-group-toggle float-right" data-toggle="buttons">
            <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple active" id="gridView">
              <input type="radio" name="options" checked>
              <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Grid View</span>
              <span class="d-block d-sm-none">
                <i class="fas fa-th"></i>
              </span>
            </label>
            <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" id="tableView">
              <input type="radio" class="d-none d-sm-none" name="options">
              <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Table View</span>
              <span class="d-block d-sm-none">
                <i class="fas fa-table"></i>
              </span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <br>

    <div class="row">
      <div id="gridData" class="col-md-12">
        <div class="card">
          <div class="card-body">
            <div id="placesgrid" class="row flex-fix-margin">
              {# <div class="card-deck"> Either use "card-deck" or "col" for 2 different UI styles #}
              <div id="helptooltip3" class="col box" data-toggle="modal" data-target="#gridModal" data-name="La Grande Boucherie" data-day="Monday - 19 Hour" data-live="91" data-spent="90" data-id="0" data-populartimes="14 6 1 0 0 0 0 0 3 16 29 34 46 51 47 38 26 25 37 55 70 70 55 33,12 1 1 0 0 0 0 0 8 26 48 66 71 61 43 28 23 30 45 62 71 70 57 38,19 5 1 0 0 0 0 0 3 15 35 59 75 72 53 33 23 29 44 57 61 52 34 16,2 1 1 0 0 0 0 0 5 20 38 55 63 60 48 33 26 31 47 65 75 70 54 34,16 5 1 0 0 0 0 0 7 31 65 93 99 80 51 29 24 33 50 66 75 72 59 41,22 7 1 0 0 0 0 0 1 5 34 73 100 90 55 24 13 17 29 42 51 55 52 43,30 17 6 0 0 0 0 0 1 1 1 3 7 11 11 9 7 10 23 43 53 47 33 22,">
                <div class="card trending">
                  <div class="card-header">
                    <div class="row">
                      <div class="col-4">                      
                      </div>
                      <div class="col-4">
                        <div class="count-up-example-1 place-number text-center" data-from="0" data-to="91" data-time="400">
                          0
                        </div>
                      </div>                     
                      <div class="col-2">
                        <i class="tim-icons icon-minimal-up place-trend-up"></i>
                        <div class="place-trend-up">
                          40
                        </div>
                      </div>
                      <div class="col-2 float-left" style="backface-visibility: hidden;">
                        <span class="text-danger live-text">
                          LIVE
                        </span>                                            
                      </div>                      
                    </div>
                  </div>
                  <div class="card-body place-title">
                    <h4 class="card-title">La Grande Boucherie</h4>
                    {# <p class="card-text"> </p> #}
                  </div>
                  <div class="card-footer container">                  
                    <small class="text-muted">145 W 53rd St, New York, NY 10019, United States</small>
                    <div class="row">
                      <div class="col">
                      </div>
                      <div class="col-auto">
                      </div>
                      <div class="col-2 col-xl-1 float-right">
                        <i class="fas fa-info-circle"></i>
                      </div>
                    </div>
                  </div>                
                </div>    
              </div>  
              <div class="col box" data-toggle="modal" data-target="#gridModal" data-name="Petrossian Boutique & Cafe" data-day="Monday - 19 Hour" data-live="52" data-spent="" data-id="0" data-populartimes="0 0 0 0 0 0 0 0 11 23 41 54 50 36 29 26 29 31 31 25 16 7 4 3,0 0 0 0 0 0 0 0 4 13 24 34 39 39 37 34 33 34 35 35 34 30 25 19,0 0 0 0 0 0 0 0 13 28 43 56 60 56 44 32 24 21 23 25 24 19 12 4,0 0 0 0 0 0 0 0 10 24 39 52 59 56 46 34 26 27 34 41 42 35 27 19,0 0 0 0 0 0 0 0 15 28 40 48 50 47 38 31 27 29 34 39 39 35 29 21,0 0 0 0 0 0 0 0 6 19 42 70 94 100 86 61 39 28 26 28 26 19 10 3,0 0 0 0 0 0 0 0 0 0 0 52 80 87 72 51 39 34 31 28 23 18 12 7,">
                <div class="card">
                  <div class="card-header">
                    <div class="row">
                      <div class="col-4">                      
                      </div>
                      <div class="col-4">
                        <div class="count-up-example-2 place-number text-center" data-from="0" data-to="52" data-time="400">
                          0
                        </div>
                      </div>
                      <div class="col-2">
                        <i class="tim-icons icon-minimal-up place-trend-up"></i>
                        <div class="place-trend-up">
                          16
                        </div>
                      </div>
                      <div class="col-2 float-left" style="backface-visibility: hidden;">
                        <span class="text-danger live-text">
                          LIVE
                        </span>                                            
                      </div>                       
                    </div>
                  </div>
                  <div class="card-body place-title">
                    <h4 class="card-title">Petrossian Boutique & Cafe</h4>
                    {# <p class="card-text"> </p> #}
                  </div>
                  <div class="card-footer container">                  
                    <small class="text-muted">253 W 51st St, New York, NY 10019, United States</small>
                    <div class="row">
                      <div class="col">
                      </div>
                      <div class="col-auto">
                      </div>
                      <div class="col-2 col-xl-1 float-right">
                        <i class="fas fa-info-circle"></i>
                      </div>
                    </div>
                  </div>                
                </div>    
              </div>             
              <div class="col box" data-toggle="modal" data-target="#gridModal" data-name="Brooklyn Diamond Coffee" data-day="Monday - 19 Hour" data-live="8" data-spent="60" data-id="0" data-populartimes="0 0 0 0 0 0 27 40 51 59 78 82 64 39 31 23 18 27 37 46 47 36 0 0,0 0 0 0 0 0 25 33 40 54 74 93 97 81 55 34 25 26 32 36 37 32 0 0,0 0 0 0 0 0 16 30 49 66 76 75 64 49 35 27 26 30 35 38 37 31 0 0,0 0 0 0 0 0 16 31 50 69 81 83 76 66 57 53 52 52 50 45 38 30 0 0,0 0 0 0 0 0 25 35 45 55 71 90 100 85 58 39 33 35 38 39 38 35 0 0,0 0 0 0 0 0 30 39 47 54 61 69 72 63 47 32 26 28 33 36 35 28 0 0,0 0 0 0 0 0 0 25 33 38 38 35 30 24 21 23 28 33 37 34 27 18 0 0,">
                <div class="card">
                  <div class="card-header">
                    <div class="row">
                      <div class="col-4">                      
                      </div>
                      <div class="col-4">
                        <div class="count-up-example-3 place-number text-center" data-from="0" data-to="8" data-time="400">
                          0
                        </div>
                      </div>
                      <div class="col-2">
                        <i class="tim-icons icon-minimal-down place-trend-down"></i>
                        <div class="place-trend-down">
                          -31
                        </div>
                      </div>
                      <div class="col-2 float-left" style="backface-visibility: hidden;">
                        <span class="text-danger live-text">
                          LIVE
                        </span>                                            
                      </div>                       
                    </div>
                  </div>
                  <div class="card-body place-title">
                    <h4 class="card-title">Brooklyn Diamond Coffee</h4>
                    {# <p class="card-text"> </p> #}
                  </div>
                  <div class="card-footer container">                  
                    <small class="text-muted">240 E 54th St, New York, NY 10022, United States	</small>
                    <div class="row">
                      <div class="col">
                      </div>
                      <div class="col-auto">
                      </div>
                      <div class="col-2 col-xl-1 float-right">
                        <i class="fas fa-info-circle"></i>
                      </div>
                    </div>
                  </div>                
                </div>    
              </div> 
              {# </div> #}                                        
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="row">
      <div id="tableData" class="col-lg-6 col-md-12 h-100" style="display: none;">
        <div class="card h-100">
          {# <div class="card-header">
            <h4 class="card-title">Places</h4>
          </div> #}
          <div class="card-body">
            <div class="table-responsive">
              <table id="placestable" class="table tablesorter">
                <thead>
                  <tr>
                    <th>
                      Name
                    </th>
                    <th>
                      Address
                    </th>
                    <th class="text-center">
                      Rating (#)
                    </th>
                    <th class="text-center">
                      Usual Pop.
                    </th>   
                    <th class="text-center">
                      Live Pop.
                    </th>                       
                    <th class="text-center">
                      Trend
                    </th>                                     
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      La Grande Boucherie
                    </td>
                    <td>
                      145 W 53rd St, New York, NY 10019, United States
                    </td>
                    <td class="text-center">
                      4.5 (578)
                    </td>
                    <td class="text-center">
                      51
                    </td>
                    <td class="text-center">
                      91
                    </td>                    
                    <td class="text-center">
                      <p class="text-success">+40</p>
                    </td>                    
                  </tr>                
                  <tr>
                    <td>
                      Petrossian Boutique & Cafe
                    </td>
                    <td>
                      253 W 51st St, New York, NY 10019, United States
                    </td>
                    <td class="text-center">
                      4.6 (1632)
                    </td>
                    <td class="text-center">
                      36
                    </td>
                    <td class="text-center">
                      52
                    </td>                    
                    <td class="text-center">
                      <p class="text-success">+16</p>
                    </td>                    
                  </tr>
                  <tr>
                    <td>
                      Brooklyn Diamond Coffee
                    </td>
                    <td>
                      240 E 54th St, New York, NY 10022, United States
                    </td>
                    <td class="text-center">
                      4.1 (81)
                    </td>
                    <td class="text-center">
                      39
                    </td>
                    <td class="text-center">
                      8
                    </td>                    
                    <td class="text-center">
                      <p class="text-danger">-31</p>
                    </td>                    
                  </tr>                                    
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div id="actionData" class="col-lg-6 col-md-12 h-75" style="display: none;">
        <div class="card card-tasks h-75">
          <div class="card-header">
            <h4 class="title d-inline">Advanced Actions</h4>
            <p class="card-category d-inline">Under Development</p>
            {# <div class="dropdown">
              <button type="button" class="btn btn-link dropdown-toggle btn-icon" data-toggle="dropdown">
                <i class="tim-icons icon-settings-gear-63"></i>
              </button>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
                <a class="dropdown-item" href="#pablo">Action</a>
                <a class="dropdown-item" href="#pablo">Another action</a>
                <a class="dropdown-item" href="#pablo">Something else</a>
              </div>
            </div> #}
          </div>
          <div class="card-body ">
            <div class="table-full-width table-responsive">
              <table class="table">
                <tbody>
                  <tr>
                    <td>
                      <div class="form-check">
                        <label class="form-check-label">
                          <input class="form-check-input" type="checkbox" value="">
                          <span class="form-check-sign">
                            <span class="check"></span>
                          </span>
                        </label>
                      </div>
                    </td>
                    <td>
                      <p class="title">Find Trending Places</p>
                      <p class="text-muted">List all the hot, as well as dead places, that were included inthe search.</p>
                    </td>
                    <td class="td-actions text-right">
                      <button type="button" class="btn btn-link">
                        <i class="tim-icons icon-double-right"></i>
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="form-check">
                        <label class="form-check-label">
                          <input class="form-check-input" type="checkbox" value="">
                          <span class="form-check-sign">
                            <span class="check"></span>
                          </span>
                        </label>
                      </div>
                    </td>
                    <td>
                      <p class="title">Perform Data Analysis</p>
                      <p class="text-muted">Execute advanced data analysis per places with the use of Statistical Methods.</p>
                    </td>
                    <td class="td-actions text-right">
                      <button type="button" class="btn btn-link">
                        <i class="tim-icons icon-double-right"></i>
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="form-check">
                        <label class="form-check-label">
                          <input class="form-check-input" type="checkbox" value="">
                          <span class="form-check-sign">
                            <span class="check"></span>
                          </span>
                        </label>
                      </div>
                    </td>
                    <td>
                      <p class="title">Map Visualization</p>
                      <p class="text-muted">Visualize the results on a map in the form of circles.</p>
                    </td>
                    <td class="td-actions text-right">
                      <button type="button" class="btn btn-link">
                        <i class="tim-icons icon-double-right"></i>
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="form-check">
                        <label class="form-check-label">
                          <input class="form-check-input" type="checkbox" value="">
                          <span class="form-check-sign">
                            <span class="check"></span>
                          </span>
                        </label>
                      </div>
                    </td>
                    <td>
                      <p class="title">Release v2.0</p>
                      <p class="text-muted">Codebase Improvements.</p>
                    </td>
                    <td class="td-actions text-right">
                      <button type="button" class="btn btn-link">
                        <i class="tim-icons icon-double-right"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-sm-10">     
        <div class="card card-nav-tabs">
          <div class="card-body" style="padding-bottom: 15px;">
            <blockquote class="blockquote mb-0">
              <footer class="blockquote-footer">A Strange Game. The only winning Move is not to Play. How about a nice game of Chess?</footer>
            </blockquote>
          </div>
        </div>
      </div> 
    </div>    

    <!-- Modal -->        
    <div class="modal {% if current_user.ui_theme == 'dark' %}modal-black{% endif %} fade bd-example-modal-lg" id="gridModal" tabindex="-1" role="dialog" aria-labelledby="modalLongTitle" aria-hidden="true">
      <div class="modal-dialog modal-xxl" role="document">
        <div class="modal-content">
          <div class="modal-header justify-content-center">
            <h3 class="modal-title title title-up" id="modalLongTitle" style="text-transform: none;"></h5>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
              <i class="tim-icons icon-simple-remove"></i>
            </button>
          </div>

          <div class="modal-body">
            <div id="gridCarousel" class="carousel slide" data-ride="true" data-interval="5000">
              <ol class="carousel-indicators">
                <li data-target="#gridCarousel" data-slide-to="0" class="active"></li>
                <li data-target="#gridCarousel" data-slide-to="1"></li>
                <li data-target="#gridCarousel" data-slide-to="2"></li>
                <li data-target="#gridCarousel" data-slide-to="3"></li>
                <li data-target="#gridCarousel" data-slide-to="4"></li>
                <li data-target="#gridCarousel" data-slide-to="5"></li>                
                <li data-target="#gridCarousel" data-slide-to="6"></li>                
              </ol>
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <div class="row">
                    <div class="col-12">
                      <div class="card card-chart">
                        <div class="card-header ">
                          <div class="row">
                            <div class="col-sm-6 text-left">
                              <h5 class="card-category">Monday</h5>
                              <h2 class="card-title">Popularity</h2>
                            </div>
                            <div class="col-sm-6">
                              <div class="btn-group btn-group-toggle float-right" data-toggle="buttons">
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple active" name="changeChart1">
                                  <input type="radio" class="d-none d-sm-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Bar Blue</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-bar"></i>
                                  </span>
                                </label>                              
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart2">
                                  <input type="radio" name="options" checked>
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Purple</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart3">
                                  <input type="radio" class="d-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Green</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="card-body">
                          <div class="chart-area">
                            <canvas id="chartMonday"></canvas>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="carousel-caption d-none d-sm-block">
                    <p>Monday</p>
                  </div>
                </div>
                <div class="carousel-item">
                  <div class="row">
                    <div class="col-12">
                      <div class="card card-chart">
                        <div class="card-header ">
                          <div class="row">
                            <div class="col-sm-6 text-left">
                              <h5 class="card-category">Tuesday</h5>
                              <h2 class="card-title">Popularity</h2>
                            </div>
                            <div class="col-sm-6">
                              <div class="btn-group btn-group-toggle float-right" data-toggle="buttons">
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple active" name="changeChart1">
                                  <input type="radio" class="d-none d-sm-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Bar Blue</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-bar"></i>
                                  </span>
                                </label>                              
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart2">
                                  <input type="radio" name="options" checked>
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Purple</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart3">
                                  <input type="radio" class="d-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Green</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="card-body">
                          <div class="chart-area">
                            <canvas id="chartTuesday"></canvas>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="carousel-caption d-none d-sm-block">
                    <p>Tuesday</p>
                  </div>                                    
                </div>
                <div class="carousel-item">
                  <div class="row">
                    <div class="col-12">
                      <div class="card card-chart">
                        <div class="card-header ">
                          <div class="row">
                            <div class="col-sm-6 text-left">
                              <h5 class="card-category">Wednesday</h5>
                              <h2 class="card-title">Popularity</h2>
                            </div>
                            <div class="col-sm-6">
                              <div class="btn-group btn-group-toggle float-right" data-toggle="buttons">
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple active" name="changeChart1">
                                  <input type="radio" class="d-none d-sm-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Bar Blue</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-bar"></i>
                                  </span>
                                </label>                              
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart2">
                                  <input type="radio" name="options" checked>
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Purple</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart3">
                                  <input type="radio" class="d-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Green</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="card-body">
                          <div class="chart-area">
                            <canvas id="chartWednesday"></canvas>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="carousel-caption d-none d-sm-block">
                    <p>Wednesday</p>
                  </div>                                     
                </div>
                <div class="carousel-item">
                  <div class="row">
                    <div class="col-12">
                      <div class="card card-chart">
                        <div class="card-header ">
                          <div class="row">
                            <div class="col-sm-6 text-left">
                              <h5 class="card-category">Thursday</h5>
                              <h2 class="card-title">Popularity</h2>
                            </div>
                            <div class="col-sm-6">
                              <div class="btn-group btn-group-toggle float-right" data-toggle="buttons">
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple active" name="changeChart1">
                                  <input type="radio" class="d-none d-sm-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Bar Blue</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-bar"></i>
                                  </span>
                                </label>                              
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart2">
                                  <input type="radio" name="options" checked>
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Purple</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart3">
                                  <input type="radio" class="d-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Green</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="card-body">
                          <div class="chart-area">
                            <canvas id="chartThursday"></canvas>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="carousel-caption d-none d-sm-block">
                    <p>Thursday</p>
                  </div>                                     
                </div>
                <div class="carousel-item">
                  <div class="row">
                    <div class="col-12">
                      <div class="card card-chart">
                        <div class="card-header ">
                          <div class="row">
                            <div class="col-sm-6 text-left">
                              <h5 class="card-category">Friday</h5>
                              <h2 class="card-title">Popularity</h2>
                            </div>
                            <div class="col-sm-6">
                              <div class="btn-group btn-group-toggle float-right" data-toggle="buttons">
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple active" name="changeChart1">
                                  <input type="radio" class="d-none d-sm-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Bar Blue</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-bar"></i>
                                  </span>
                                </label>                              
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart2">
                                  <input type="radio" name="options" checked>
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Purple</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart3">
                                  <input type="radio" class="d-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Green</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="card-body">
                          <div class="chart-area">
                            <canvas id="chartFriday"></canvas>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="carousel-caption d-none d-sm-block">
                    <p>Friday</p>
                  </div>                                     
                </div>
                <div class="carousel-item">
                  <div class="row">
                    <div class="col-12">
                      <div class="card card-chart">
                        <div class="card-header ">
                          <div class="row">
                            <div class="col-sm-6 text-left">
                              <h5 class="card-category">Saturday</h5>
                              <h2 class="card-title">Popularity</h2>
                            </div>
                            <div class="col-sm-6">
                              <div class="btn-group btn-group-toggle float-right" data-toggle="buttons">
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple active" name="changeChart1">
                                  <input type="radio" class="d-none d-sm-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Bar Blue</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-bar"></i>
                                  </span>
                                </label>                              
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart2">
                                  <input type="radio" name="options" checked>
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Purple</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart3">
                                  <input type="radio" class="d-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Green</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="card-body">
                          <div class="chart-area">
                            <canvas id="chartSaturday"></canvas>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="carousel-caption d-none d-sm-block">
                    <p>Saturday</p>
                  </div>                                     
                </div>
                <div class="carousel-item">
                  <div class="row">
                    <div class="col-12">
                      <div class="card card-chart">
                        <div class="card-header ">
                          <div class="row">
                            <div class="col-sm-6 text-left">
                              <h5 class="card-category">Sunday</h5>
                              <h2 class="card-title">Popularity</h2>
                            </div>
                            <div class="col-sm-6">
                              <div class="btn-group btn-group-toggle float-right" data-toggle="buttons">
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple active" name="changeChart1">
                                  <input type="radio" class="d-none d-sm-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Bar Blue</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-bar"></i>
                                  </span>
                                </label>                              
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart2">
                                  <input type="radio" name="options" checked>
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Purple</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                                <label class="btn-{{ current_user.ui_button }} btn btn-sm btn-simple" name="changeChart3">
                                  <input type="radio" class="d-none" name="options">
                                  <span class="d-none d-sm-block d-md-block d-lg-block d-xl-block">Line Green</span>
                                  <span class="d-block d-sm-none">
                                    <i class="fas fa-chart-line"></i>
                                  </span>
                                </label>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="card-body">
                          <div class="chart-area">
                            <canvas id="chartSunday"></canvas>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="carousel-caption d-none d-sm-block">
                    <p>Sunday</p>
                  </div>                                     
                </div>                                                                
              </div>
              <a class="carousel-control carousel-control-prev" href="#gridCarousel" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control carousel-control-next" href="#gridCarousel" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            </div>    
            <div id="calculatorTimeDiv" class="row justify-content-center modal-text-below" style="opacity: 0;">
              <p>Time Spent Calculator: People Spend Exactly <span class="text-primary"></span> on this Place</p>
            </div>
            <div id="calculatorCrowdDiv" class="row justify-content-center modal-text-below" style="opacity: 0;">
              <p>Crowd Size Calculator: <span class="text-primary">Click</span> Below and Help in the Calculation</p> 
            </div>
            <div id="calculatorButtonDiv" class="row justify-content-center modal-text-below" style="opacity: 0; padding-top: 0px;">
              <button id="calculatorButton" type="button" class="btn btn-{{ current_user.ui_button}} btn-link btn-icon btn-sm">
                <i class="fas fa-calculator"></i>
              </button>              
            </div>
            <div id="calculatorDiv" style="display: none; padding-top: 0px;">
              <div class="row justify-content-center modal-text-below" style="padding-top: 0px;">
                <div class="col">        
                    <p>Approximately, <span class="text-primary">how many people</span> were there at the time of the search?:</p>
                </div>                       
              </div>
              <div class="row justify-content-center modal-text-below">
                <div class="col-md-1 col-sm-2 col-3 px-0">                      
                </div>              
                <div id="userInputDiv" class="col-md-1 col-sm-2 col-3 px-0">              
                    <input type="number" class="form-control form-{{ current_user.ui_color }}" id="userInput" name="userInput" placeholder="1"/>                    
                </div> 
                <div class="col-md-1 col-sm-2 col-3 px-0">               
                  <button id="addInput" type="button" class="btn btn-success btn-link btn-icon btn-sm float-left">
                    <i class="tim-icons icon-simple-add"></i>
                  </button>                  
                </div>                                       
              </div>              
              <div class="row justify-content-center modal-text-below">
                <div class="col-lg-2 col-md-3 col-sm-4 col-auto">             
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                            <div class="input-group-text form-{% if current_user.is_authenticated %}{{current_user.ui_color}}{% else %}blue{% endif %}" style="padding: 8px 0 8px 18px">
                              <label style="margin-bottom: 0rem;"><span class="text-danger live-text-calculator">LIVE</span>                   
                                <i class="fas fa-users"></i>
                              </label>
                          </div>      
                      </div>                     
                      <input readonly="" type="text" class="form-control form-{% if current_user.is_authenticated %}{{current_user.ui_color}}{% else %}blue{% endif %}" id="crowd" name="crowd" style="color: rgba(255, 255, 255, 0.8);"/>
                    </div>
                  </div>  
                </div>                   
              </div>                                      
            </div>            
          </div>           

          <div class="modal-footer">
          <button id="closebutton" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>

        </div>
      </div>
    </div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

  <script>
    const container = document.querySelector('.main-panel');
    hour_labels = ["6am", "7am", "8am", "9am", "10am", "11am", "12pm", "1pm", "2pm", "3pm", "4pm", "5pm", "6pm", "7pm", "8pm", "9pm", "10pm", "11pm", "12am", "1am", "2am", "3am", "4am", "5am"];   
    hour_labels_mapping = { '06': 0, '07': 1, '08': 2, '09': 3, '10': 4, '11': 5, '12': 6, '13': 7, '14': 8, '15': 9, '16': 10, '17': 11, '18': 12, '19': 13, '20': 14, '21': 15, '22': 16, '23': 17, '24': 18, '01': 19, '02': 20, '03': 21, '04': 22, '05': 23 }  
    day_labels_mapping = { 'Monday': 0, 'Tuesday': 1, 'Wednesday': 2, 'Thursday': 3, 'Friday': 4, 'Saturday': 5, 'Sunday': 6 }    
    chart_mode = 1; 

    // DOCUMENT READY
    $(document).ready(function() {
      var isWindows = navigator.platform.indexOf('Win') > -1 ? true : false;

      if (isWindows) {
        if ($('#searchHistoryList').length != 0) {
          var ps3 = new PerfectScrollbar('#searchHistoryList', {
            wheelSpeed: 2,
            wheelPropagation: false,
            minScrollbarLength: 20
            {# //useBothWheelAxes: true,
            //suppressScrollX: false,
            //suppressScrollY: false #}
          });
        }
      }

      $('.count-up-example-1').counter();
      $('.count-up-example-2').counter();
      $('.count-up-example-3').counter();

      // Hints
      {% if current_user.total_runs < 2 %}
        var template = '<div class="tooltip {% if current_user.ui_theme == 'light' %}bs-tooltip-top-white{% endif %}" role="tooltip"><div class="arrow"></div><div class="tooltip-inner {% if current_user.ui_theme == 'light' %}tooltip-inner-white{% endif %}"></div></div>';
        $('#helptooltip1').tooltip({trigger: 'manual', template: template, title: "Previous Searches"}).tooltip('show');      
        $('#helptooltip2').tooltip({trigger: 'manual', template: template, title: "Change View"}).tooltip('show');
        $('#helptooltip3').tooltip({trigger: 'manual', template: template, title: "Click Me"}).tooltip('show');

        container.addEventListener('ps-scroll-down', function() {
          $('#helptooltip1').tooltip('hide');
          $('#helptooltip2').tooltip('hide');
          $('#helptooltip3').tooltip('hide');
        }, { once: true });  // Call only once, then remove itself

        container.addEventListener('click', function() {
          $('#helptooltip1').tooltip('hide');
          $('#helptooltip2').tooltip('hide');
          $('#helptooltip3').tooltip('hide');
        }, { once: true });  // Call only once, then remove itself       
      {% endif %}             
    }); 

    // View Mode Buttons
    $('#gridView').click(function() {
      $('#tableData').slideUp();
      $('#actionData').slideUp(); 
      $('#gridData').slideDown(); 
    });

    $('#tableView').click(function() {
      $('#gridData').slideUp();
      $('#tableData').slideDown(); 
      $('#actionData').slideDown();      
    });    

    // Delete Search Button
    $('[name="deletebutton"]').click(function() {
      $.ajax({
          type: 'POST',
          data: {
              id: $(this).val(),
          },
          context: $(this).parent(),
          url: "/delete-search",
          success: function(data){ 
                  this.remove(); 
                      },
          error: function(data){
                  if (data.status == 400) {
                      helpers.showNotification('top','center', 'true', 'This is a Sample Search and thus cannot be Deleted.');    
                      }},
      });
    }); 

    // Modal Actions (Grid View)
    $('#gridModal').on('show.bs.modal', function(event) {
      // Scrolling Fix
      {# // Same Functions for vanilla scrolling
      //const body = document.querySelector("body");
      //body.style.overflow = "hidden";
      //window.scrollTop(storeScrollPos); #}
      {# // PerfectScrollbar Functions Guide - https://github.com/mdbootstrap/perfect-scrollbar/issues/339 #} 
      storeScrollPos = $('.main-panel').scrollTop();
      $html.removeClass('perfect-scrollbar-on');
      $html.addClass('perfect-scrollbar-off');

      var name = $(event.relatedTarget).data('name');  // Extract info from data-* attributes
      var spent = $(event.relatedTarget).data('spent');  // Extract info from data-* attributes   

      $("#modalLongTitle").text(name);
      if (spent) { $("#calculatorTimeDiv > p > span").text(spent + " min."); }
      else { $("#calculatorTimeDiv > p > span").text("? min."); }
    });

    $('#gridModal').on('shown.bs.modal', function(event) {
      var day = $(event.relatedTarget).data('day');  // Extract info from data-* attributes
      var live = $(event.relatedTarget).data('live');  // Extract info from data-* attributes      
      var populartimes = $(event.relatedTarget).data('populartimes');  // Extract info from data-* attributes
      var id = $(event.relatedTarget).data('id');  // Extract info from data-* attributes       

      // Initiate the Text Below the Charts
      $("#calculatorTimeDiv").animate( { opacity: 1 }, 1800 );
      $("#calculatorCrowdDiv").animate( { opacity: 1 }, 1800 );
      $("#calculatorButtonDiv").animate( { opacity: 1 }, 1800 );

      // Build the Data for Live Popularity
      var live_popularity = new Array(7).fill(null).map(() => new Array(24).fill(null));
      var day_get = day.slice(0, -10);
      var hour_get = day.slice(day.length - 7, day.length - 5);

      if (live) {
        live_popularity[day_labels_mapping[day_get]][hour_labels_mapping[hour_get]] = live;
      }

      if (populartimes) {
        var decode_populartimes = populartimes.split(',');
        for (i = 0; i < 7; i++) {
          decode_populartimes[i] = decode_populartimes[i].split(' ').map(Number);}
        
        if (live) {
          current_multiplier = live;
        }
        else {
          current_multiplier = decode_populartimes[day_labels_mapping[day_get]][hour_labels_mapping[hour_get]];
        }
      }
      else {
        var decode_populartimes = new Array(7);
        for (i = 0; i < 7; i++) {
          decode_populartimes[i] = new Array(24).fill(null);}
          current_multiplier = 100;
      }    

      $("#calculatorButton").attr('value', id + " " + current_multiplier);  // Stores an important value inside the Button

      // Initiate the Charts
      if (chart_mode == 1) {
        chartMonday = charts.gradientBarChart('chartMonday', hour_labels, decode_populartimes[0], live_popularity[0]);  
        chartTuesday = charts.gradientBarChart('chartTuesday', hour_labels, decode_populartimes[1], live_popularity[1]); 
        chartWednesday = charts.gradientBarChart('chartWednesday', hour_labels, decode_populartimes[2], live_popularity[2]); 
        chartThursday = charts.gradientBarChart('chartThursday', hour_labels, decode_populartimes[3], live_popularity[3]); 
        chartFriday = charts.gradientBarChart('chartFriday', hour_labels, decode_populartimes[4], live_popularity[4]); 
        chartSaturday = charts.gradientBarChart('chartSaturday', hour_labels, decode_populartimes[5], live_popularity[5]); 
        chartSunday = charts.gradientBarChart('chartSunday', hour_labels, decode_populartimes[6], live_popularity[6]);        
      }    
      else if (chart_mode == 2) {
        chartMonday = charts.gradientChartWithTooltipPurple('chartMonday', hour_labels, decode_populartimes[0], live_popularity[0]);   
        chartTuesday = charts.gradientChartWithTooltipPurple('chartTuesday', hour_labels, decode_populartimes[1], live_popularity[1]);  
        chartWednesday = charts.gradientChartWithTooltipPurple('chartWednesday', hour_labels, decode_populartimes[2], live_popularity[2]); 
        chartThursday = charts.gradientChartWithTooltipPurple('chartThursday', hour_labels, decode_populartimes[3], live_popularity[3]); 
        chartFriday = charts.gradientChartWithTooltipPurple('chartFriday', hour_labels, decode_populartimes[4], live_popularity[4]); 
        chartSaturday = charts.gradientChartWithTooltipPurple('chartSaturday', hour_labels, decode_populartimes[5], live_popularity[5]); 
        chartSunday = charts.gradientChartWithTooltipPurple('chartSunday', hour_labels, decode_populartimes[6], live_popularity[6]); 
      }
      else {
        chartMonday = charts.gradientChartWithTooltipGreen('chartMonday', hour_labels, decode_populartimes[0], live_popularity[0]);  
        chartTuesday = charts.gradientChartWithTooltipGreen('chartTuesday', hour_labels, decode_populartimes[1], live_popularity[1]); 
        chartWednesday = charts.gradientChartWithTooltipGreen('chartWednesday', hour_labels, decode_populartimes[2], live_popularity[2]); 
        chartThursday = charts.gradientChartWithTooltipGreen('chartThursday', hour_labels, decode_populartimes[3], live_popularity[3]); 
        chartFriday = charts.gradientChartWithTooltipGreen('chartFriday', hour_labels, decode_populartimes[4], live_popularity[4]); 
        chartSaturday = charts.gradientChartWithTooltipGreen('chartSaturday', hour_labels, decode_populartimes[5], live_popularity[5]); 
        chartSunday = charts.gradientChartWithTooltipGreen('chartSunday', hour_labels, decode_populartimes[6], live_popularity[6]); 
      }      

    });

    $('#gridModal').on('hide.bs.modal', function(event) { 
      // Scrolling Fix
      {# // Same Functions for vanilla scrolling
        //const body = document.querySelector("body");
        //body.style.overflow = null; #}
      $html.removeClass('perfect-scrollbar-off');
      $html.addClass('perfect-scrollbar-on');
      $('.main-panel').scrollTop(storeScrollPos);
      
      $("#calculatorDiv").slideUp();
      $('#userInputDiv').removeClass('has-danger');        
      $('#userInput').removeClass('form-control-danger');   
      $('#userInputDiv').removeClass('has-success');        
      $('#userInput').removeClass('form-control-success');      

      // Destroy the Charts
      chartMonday.destroy();
      chartTuesday.destroy();
      chartWednesday.destroy();  
      chartThursday.destroy();
      chartFriday.destroy();
      chartSaturday.destroy(); 
      chartSunday.destroy(); 
    });  

    $('#addInput').click(function() {
      var get_from_button = $('#calculatorButton').val().split(" ");
      {# //var input = $('#userInput').val() * 100 / $('#calculatorButton').data('multiplier');  // Was Extremely Buggy #}
      var id = parseInt(get_from_button[0]);
      var multiplier = parseInt(get_from_button[1]);
      var input =  $('#userInput').val() * 100 / multiplier;

      if (!input || input < 1) {
        $('#userInputDiv').addClass('has-danger');        
        $('#userInput').addClass('form-control-danger');              
        helpers.showNotification('top','center', 'true', 'Hint: Re-type the Values in <font color="#ec250d">Red</font>.') 
      }
      else if (id == 0) {
        $('#userInputDiv').addClass('has-danger');        
        $('#userInput').addClass('form-control-danger');         
        helpers.showNotification('top','center', 'true', 'This is a Sample Search, try using the Calculator in a real-world Search!');       
      }
      else {
        $.ajax({
            type: 'POST',
            data: {
                id: id,
                input: input
            },
            url: "/set-person-count",
            success: function(data){ 
                    $('#userInputDiv').removeClass('has-danger');        
                    $('#userInput').removeClass('form-control-danger');   
                    $('#userInputDiv').addClass('has-success');        
                    $('#userInput').addClass('form-control-success');                                 
                    helpers.showNotification('top','center', 'true', 'Thank your for you Input! The Calculator will take it into account from now on.');
                    $.ajax({
                        type: 'POST',
                        data: {
                            id: id,
                        },
                        url: "/get-person-count",
                        success: function(data){ 
                                if (data[0]["count"] == -1) {
                                  $("#crowd").val("N/A");
                                }
                                else {
                                  var get_from_button = $('#calculatorButton').val().split(" ");
                                  var multiplier = parseInt(get_from_button[1]);
                                  var output =  data[0]["count"] * multiplier / 100;
                                  $("#crowd").val(output.toFixed(1));
                                }
                                    },
                        error: function(data){
                                helpers.showNotification('top','center', 'true', 'Data Request Error.');
                                    },
                    });                     
                        },
            error: function(data){
                    helpers.showNotification('top','center', 'true', 'Data Request Error.');
                        },
        });
      }      
    });

    $('#calculatorButton').click(function() {
      $("#calculatorDiv").slideToggle()
      
      var get_from_button = $('#calculatorButton').val().split(" ");

      $.ajax({
          type: 'POST',
          data: {
              id: parseInt(get_from_button[0]),
          },
          url: "/get-person-count",
          success: function(data){ 
                  if (data[0]["count"] == -1) {
                    $("#crowd").val("N/A");
                  }
                  else {
                    var get_from_button = $('#calculatorButton').val().split(" ");
                    var multiplier = parseInt(get_from_button[1]);
                    var output =  data[0]["count"] * multiplier / 100;
                    $("#crowd").val(output.toFixed(1));
                  }
                      },
          error: function(data){
                  helpers.showNotification('top','center', 'true', 'Data Request Error.');
                      },
      });      
    });

    $('label[name="changeChart1"]').click(function() {
      chart_mode = 1;
      $('label[name="changeChart1"]').addClass('active');
      $('label[name="changeChart2"]').removeClass('active');
      $('label[name="changeChart3"]').removeClass('active');  
      $('#closebutton').click();
     
    });    

    $('label[name="changeChart2"]').click(function() {
      chart_mode = 2;
      $('label[name="changeChart1"]').removeClass('active');
      $('label[name="changeChart2"]').addClass('active');
      $('label[name="changeChart3"]').removeClass('active'); 
      $('#closebutton').click();      
    });

    $('label[name="changeChart3"]').click(function() {
      chart_mode = 3;
      $('label[name="changeChart1"]').removeClass('active');
      $('label[name="changeChart2"]').removeClass('active');
      $('label[name="changeChart3"]').addClass('active');
      $('#closebutton').click();
    });          

    // Main Actions
    $('.list-group-item-action').click(function() {
      var divSelector = $("#" + $(this).attr('id').slice(0, -5));
      var id = divSelector.find("table > tbody > tr > :first-child").html();

      if (id == 0) {
        //-- Update the Grid --//
        var gridSelector = $("#placesgrid");

        gridSelector.children().remove();  // Wipe

        var content = '<div id="helptooltip3" class="col box" data-toggle="modal" data-target="#gridModal" data-name="La Grande Boucherie" data-day="Monday - 19 Hour" data-live="91" data-spent="90" data-id="0" data-populartimes="14 6 1 0 0 0 0 0 3 16 29 34 46 51 47 38 26 25 37 55 70 70 55 33,12 1 1 0 0 0 0 0 8 26 48 66 71 61 43 28 23 30 45 62 71 70 57 38,19 5 1 0 0 0 0 0 3 15 35 59 75 72 53 33 23 29 44 57 61 52 34 16,2 1 1 0 0 0 0 0 5 20 38 55 63 60 48 33 26 31 47 65 75 70 54 34,16 5 1 0 0 0 0 0 7 31 65 93 99 80 51 29 24 33 50 66 75 72 59 41,22 7 1 0 0 0 0 0 1 5 34 73 100 90 55 24 13 17 29 42 51 55 52 43,30 17 6 0 0 0 0 0 1 1 1 3 7 11 11 9 7 10 23 43 53 47 33 22,"> <div class="card trending"> <div class="card-header"> <div class="row"> <div class="col-4"> </div><div class="col-4"> <div class="count-up-example-1 place-number text-center" data-from="0" data-to="91" data-time="400"> 0 </div></div><div class="col-2"> <i class="tim-icons icon-minimal-up place-trend-up"></i> <div class="place-trend-up"> 40 </div></div><div class="col-2 float-left" style="backface-visibility: hidden;"> <span class="text-danger live-text"> LIVE </span> </div></div></div><div class="card-body place-title"> <h4 class="card-title">La Grande Boucherie</h4>{# <p class="card-text"> </p>#}</div><div class="card-footer container"> <small class="text-muted">145 W 53rd St, New York, NY 10019, United States</small> <div class="row"> <div class="col"> </div><div class="col-auto"> </div><div class="col-2 col-xl-1 float-right"> <i class="fas fa-info-circle"></i> </div></div></div></div></div><div class="col box" data-toggle="modal" data-target="#gridModal" data-name="Petrossian Boutique & Cafe" data-day="Monday - 19 Hour" data-live="52" data-spent="" data-id="0" data-populartimes="0 0 0 0 0 0 0 0 11 23 41 54 50 36 29 26 29 31 31 25 16 7 4 3,0 0 0 0 0 0 0 0 4 13 24 34 39 39 37 34 33 34 35 35 34 30 25 19,0 0 0 0 0 0 0 0 13 28 43 56 60 56 44 32 24 21 23 25 24 19 12 4,0 0 0 0 0 0 0 0 10 24 39 52 59 56 46 34 26 27 34 41 42 35 27 19,0 0 0 0 0 0 0 0 15 28 40 48 50 47 38 31 27 29 34 39 39 35 29 21,0 0 0 0 0 0 0 0 6 19 42 70 94 100 86 61 39 28 26 28 26 19 10 3,0 0 0 0 0 0 0 0 0 0 0 52 80 87 72 51 39 34 31 28 23 18 12 7,"> <div class="card"> <div class="card-header"> <div class="row"> <div class="col-4"> </div><div class="col-4"> <div class="count-up-example-2 place-number text-center" data-from="0" data-to="52" data-time="400"> 0 </div></div><div class="col-2"> <i class="tim-icons icon-minimal-up place-trend-up"></i> <div class="place-trend-up"> 16 </div></div><div class="col-2 float-left" style="backface-visibility: hidden;"> <span class="text-danger live-text"> LIVE </span> </div></div></div><div class="card-body place-title"> <h4 class="card-title">Petrossian Boutique & Cafe</h4>{# <p class="card-text"> </p>#}</div><div class="card-footer container"> <small class="text-muted">253 W 51st St, New York, NY 10019, United States</small> <div class="row"> <div class="col"> </div><div class="col-auto"> </div><div class="col-2 col-xl-1 float-right"> <i class="fas fa-info-circle"></i> </div></div></div></div></div><div class="col box" data-toggle="modal" data-target="#gridModal" data-name="Brooklyn Diamond Coffee" data-day="Monday - 19 Hour" data-live="8" data-spent="60" data-id="0" data-populartimes="0 0 0 0 0 0 27 40 51 59 78 82 64 39 31 23 18 27 37 46 47 36 0 0,0 0 0 0 0 0 25 33 40 54 74 93 97 81 55 34 25 26 32 36 37 32 0 0,0 0 0 0 0 0 16 30 49 66 76 75 64 49 35 27 26 30 35 38 37 31 0 0,0 0 0 0 0 0 16 31 50 69 81 83 76 66 57 53 52 52 50 45 38 30 0 0,0 0 0 0 0 0 25 35 45 55 71 90 100 85 58 39 33 35 38 39 38 35 0 0,0 0 0 0 0 0 30 39 47 54 61 69 72 63 47 32 26 28 33 36 35 28 0 0,0 0 0 0 0 0 0 25 33 38 38 35 30 24 21 23 28 33 37 34 27 18 0 0,"> <div class="card"> <div class="card-header"> <div class="row"> <div class="col-4"> </div><div class="col-4"> <div class="count-up-example-3 place-number text-center" data-from="0" data-to="8" data-time="400"> 0 </div></div><div class="col-2"> <i class="tim-icons icon-minimal-down place-trend-down"></i> <div class="place-trend-down"> -31 </div></div><div class="col-2 float-left" style="backface-visibility: hidden;"> <span class="text-danger live-text"> LIVE </span> </div></div></div><div class="card-body place-title"> <h4 class="card-title">Brooklyn Diamond Coffee</h4>{# <p class="card-text"> </p>#}</div><div class="card-footer container"> <small class="text-muted">240 E 54th St, New York, NY 10022, United States</small> <div class="row"> <div class="col"> </div><div class="col-auto"> </div><div class="col-2 col-xl-1 float-right"> <i class="fas fa-info-circle"></i> </div></div></div></div></div>';

        gridSelector.append(content);

        $('.count-up-example-1').counter();
        $('.count-up-example-2').counter();
        $('.count-up-example-3').counter();      

        //-- Update the Table --//
        var tableSelector = $("#placestable");       
        
        tableSelector.find("tbody > tr").remove();  // Wipe        
        
        var content = '<tr><td> La Grande Boucherie </td><td> 145 W 53rd St, New York, NY 10019, United States </td><td class="text-center"> 4.5 (578) </td><td class="text-center"> 51 </td><td class="text-center"> 91 </td><td class="text-center"> <p class="text-success">+40</p></td></tr><tr> <td> Petrossian Boutique & Cafe </td><td> 253 W 51st St, New York, NY 10019, United States </td><td class="text-center"> 4.6 (1632) </td><td class="text-center"> 36 </td><td class="text-center"> 52 </td><td class="text-center"> <p class="text-success">+16</p></td></tr><tr> <td> Brooklyn Diamond Coffee </td><td> 240 E 54th St, New York, NY 10022, United States </td><td class="text-center"> 4.1 (81) </td><td class="text-center"> 39 </td><td class="text-center"> 8 </td><td class="text-center"> <p class="text-danger">-31</p></td></tr>';

        tableSelector.children("tbody").append(content);
      }
      else {
      $.ajax({
            type: 'POST',
            data: {
                id: id,
            },
            url: "/get-place-results",
            success: function(data){ 
                    {# //console.log(data);  // JSON.stringify #}

                    //-- Update the Grid --//
                    var gridSelector = $("#placesgrid");

                    gridSelector.children().remove();  // Wipe

                    for (i = 0; i < data.length; i++) {  // Rebuild
                      if (data[i].live_popularity === "") {
                        // Step 1
                        if (data[i].usual_popularity > 89) {var content = '<div class="col box" data-toggle="modal" data-target="#gridModal" data-name="' + data[i].name + '" data-day="' + data[i].day + '" data-live="' + data[i].live_popularity + '" data-spent="' + data[i].time_spent + '" data-id="' + data[i].global_id + '" data-populartimes="' + data[i].popular_times + '"> <div class="card trending"> <div class="card-header"> <div class="row"> <div class="col-4"> </div>';}
                        else {var content = '<div class="col box" data-toggle="modal" data-target="#gridModal" data-name="' + data[i].name + '" data-day="' + data[i].day + '" data-live="' + data[i].live_popularity + '" data-spent="' + data[i].time_spent + '" data-id="' + data[i].global_id + '" data-populartimes="' + data[i].popular_times + '"> <div class="card"> <div class="card-header"> <div class="row"> <div class="col-4"> </div>';}

                        // Step 2
                        if (data[i].usual_popularity === "") {content += '<div class="col-4"> <div class="count-up-' + i + ' place-number text-center" data-from="0" data-to="0" data-time="400"><p class="text-muted">N/A</p></div></div>';}                      
                        else {content += '<div class="col-4"> <div class="count-up-' + i + ' place-number text-center" data-from="0" data-to=\"' + data[i].usual_popularity + '\" data-time="400"> 0 </div></div>';}
                      }
                      else {
                        // Step 1                        
                        if (data[i].live_popularity > 89) {var content = '<div class="col box" data-toggle="modal" data-target="#gridModal" data-name="' + data[i].name + '" data-day="' + data[i].day + '" data-live="' + data[i].live_popularity + '" data-spent="' + data[i].time_spent + '" data-id="' + data[i].global_id + '" data-populartimes="' + data[i].popular_times + '"> <div class="card trending"> <div class="card-header"> <div class="row"> <div class="col-4"> </div>';}
                        else {var content = '<div class="col box" data-toggle="modal" data-target="#gridModal" data-name="' + data[i].name + '" data-day="' + data[i].day + '" data-live="' + data[i].live_popularity + '" data-spent="' + data[i].time_spent + '" data-id="' + data[i].global_id + '" data-populartimes="' + data[i].popular_times + '"> <div class="card"> <div class="card-header"> <div class="row"> <div class="col-4"> </div>';}

                        // Step 2                     
                        content += '<div class="col-4"> <div class="count-up-' + i + ' place-number text-center" data-from="0" data-to=\"' + data[i].live_popularity + '\" data-time="400"> 0 </div></div>';
                      }

                      // Step 3
                      if (data[i].difference === "") {content += '<div class="col-2"> <i class="tim-icons icon-simple-delete place-trend-none"></i> <div class="place-trend-none">N/A</div></div>';}
                      else if (data[i].difference > 0) {content += '<div class="col-2"> <i class="tim-icons icon-minimal-up place-trend-up"></i> <div class="place-trend-up">' + data[i].difference + '</div></div>';}
                      else if (data[i].difference < 0) {content += '<div class="col-2"> <i class="tim-icons icon-minimal-down place-trend-down"></i> <div class="place-trend-down">' + data[i].difference + '</div></div>';}
                      else {content += '<div class="col-2"> <i class="tim-icons icon-simple-delete"></i> <div class="">' + data[i].difference + '</div></div>';}

                      // Step 4
                      if (data[i].live_popularity === "") {
                        content += '<div class="col-2 float-left" style="backface-visibility: hidden;"> <span class="text-danger live-text"> </span></div>';
                      }
                      else {
                        content += '<div class="col-2 float-left" style="backface-visibility: hidden;"> <span class="text-danger live-text"> LIVE </span></div>';
                      }

                      // Step 5
                      content += '</div></div> <div class="card-body place-title">';
                      content += '<h4 class="card-title">' + data[i].name +'</h4>';
                      content += '</div> <div class="card-footer container">'
                      content += '<small class="text-muted">' + data[i].address + '</small>';
                      content += '<div class="row"> <div class="col"> </div><div class="col-auto"> </div><div class="col col-2 col-xl-1 float-right"> <i class="fas fa-info-circle"></i> </div></div></div></div></div>';

                      gridSelector.append(content);

                      if (data[i].usual_popularity != "") {$('.count-up-'+ i).counter();}
                    }

                    // Correct the currently active Carousel Page
                    if (data.length) {
                      day = data[0].day.slice(0, -10);
                      var carouselSelector1 = $(".carousel-item");
                      var carouselSelector2 = $("li[data-target='#gridCarousel']");
                      carouselSelector1.removeClass('active');
                      carouselSelector1.eq(day_labels_mapping[day]).addClass('active');
                      carouselSelector2.removeClass('active');
                      carouselSelector2.eq(day_labels_mapping[day]).addClass('active');    
                    }                

                    //-- Update the Table --//
                    var tableSelector = $("#placestable");

                    tableSelector.find("tbody > tr").remove();  // Wipe

                    for (i = 0; i < data.length; i++) {  // Rebuild 
                      // Step 1                    
                      var content = "<tr>";                     
                      content += "<td>" + data[i].name + "</td>";
                      content += "<td>" + data[i].address + "</td>";
                      content += "<td class='text-center'>" + data[i].rating + "</td>";

                      // Step 2
                      if (data[i].usual_popularity === "") {content += "<td class='text-center'><p class='text-muted'>N/A</p></td>";}                      
                      else {content += "<td class='text-center'>" + data[i].usual_popularity + "</td>";}

                      // Step 3
                      if (data[i].live_popularity === "") {content += "<td class='text-center'><p class='text-muted'>N/A</p></td>";}
                      else {content += "<td class='text-center'>" + data[i].live_popularity + "</td>";}

                      // Step 4
                      if (data[i].difference === "") {content += "<td class='text-center'><p class='text-muted'>N/A</p></td>";}
                      else if (data[i].difference > 0) {content += "<td class='text-center'><p class='text-success'>" + data[i].difference + "</p></td>";}
                      else if (data[i].difference < 0) {content += "<td class='text-center'><p class='text-danger'>" + data[i].difference + "</p></td>";}
                      else {content += "<td class='text-center'><p>" + data[i].difference + "</p></td>";}

                      content += "</tr>";

                      tableSelector.children("tbody").append(content);
                    }
                        },
            error: function(data){
                    helpers.showNotification('top','center', 'true', 'Data Request Error.');    
                        },
        });
      }
    }); 
  </script>

  <script>
    // Helper Function - Counter
    (function ($){
      $.fn.counter = function() {
        const $this = $(this),
        numberFrom = parseInt($this.attr('data-from')),
        numberTo = parseInt($this.attr('data-to')),
        delta = numberTo - numberFrom,
        deltaPositive = delta > 0 ? 1 : 0,
        time = parseInt($this.attr('data-time')),
        changeTime = 10;
        
        let currentNumber = numberFrom,
        value = delta*changeTime/time;
        var interval1;
        const changeNumber = () => {
          currentNumber += value;
          // checks if currentNumber reached numberTo
          (deltaPositive && currentNumber >= numberTo) || (!deltaPositive &&currentNumber<= numberTo) ? currentNumber=numberTo : currentNumber;
          this.text(parseInt(currentNumber));
          currentNumber == numberTo ? clearInterval(interval1) : currentNumber;  
        }

        interval1 = setInterval(changeNumber,changeTime);
      }
    }(jQuery)); 
    
    // Helper Function - Enable Swipes on Mobile    
    $('.carousel').on('touchstart', function(event){
      const xClick = event.originalEvent.touches[0].pageX;
      $(this).one('touchmove', function(event){
          const xMove = event.originalEvent.touches[0].pageX;
          const sensitivityInPx = 14;
  
          if( Math.floor(xClick - xMove) > sensitivityInPx ){
              $(this).carousel('next');
          }
          else if( Math.floor(xClick - xMove) < -sensitivityInPx ){
              $(this).carousel('prev');
          }
      });
      $(this).on('touchend', function(){
          $(this).off('touchmove');
      });
  });

  </script>

{% endblock javascripts %}
